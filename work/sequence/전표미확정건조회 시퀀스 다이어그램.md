
### 전표미확정건조회

- GET
- /v1/account/journalize/generate

AbstractAssetsSlipGenerationService inquirySlipBySQL
기관 ist 계정과목표코드 asj_tbl_cd 1000

AssetsSlipGenerationMapper selectAssetsSlipGenerationList
```sql

WITH PT AS (SELECT

A.IST_CD

, A.PT_MNG_BSE_NO

, A.AC_PCS_IDFR_ID

, A.EVL_AREA_ID

, A.AC_EVL_TP_ID

, A.AC_MNG_GRP_ID

, A.PRD_CLS_ID

, A.PRD_TP_ID

, A.PRD_NO

, A.PT_TLZ_GRP_ID

, A.PT_TLZ_ID

, A.POF_ID

, B.PT_TRNO

, B.PRD_GRP_TC

, B.TR_PCS_TP_ID

, B.PT_BSE_DT

, B.STM_DT

, B.LNK_DPD_PT_TRNO

, B.PCS_STS_TC

, B.JRN_STS_TC

, B.JRN_BSE_DT

, B.TR_BSC_TRNO

, B.LNK_TR_PT_TRNO

, C.EVT_SNO

, C.PT_PCS_TP_ID

, C.PT_CUR_CD

, C.PCA

, C.EVL_CUR_CD

, C.VCA

, C.THCO_DRW_BNK_CD

, C.THCO_DRW_ANO

, C.CPTY_ROM_BNK_CD

, C.CPTY_ROM_ANO

, C.THCO_ROM_BNK_CD

, C.THCO_ROM_ANO

, C.CPTY_NO

, C.BRN

, D.EVL_AREA_NM

, E.TR_PCS_TP_NM

, F.PT_PCS_TP_NM

, G.POF_NM

, H.AC_PCS_IDFR_NM

, I.EVL_GRP_ID

, J.AC_EVL_TP_NM

, K.PT_TLZ_GRP_NM

, K.BKG_CTT_YN

, '1000' AS ASJ_TBL_CD

FROM TSOL_CR_PT_MNG_BSE_SFS A

INNER JOIN TSOL_CR_PT_TR_SFS B

ON A.IST_CD = '110'

  

AND B.PT_PCS_DT BETWEEN A.APLY_STT_DT AND A.APLY_END_DT

AND B.IST_CD = A.IST_CD

AND B.PT_MNG_BSE_NO = A.PT_MNG_BSE_NO

AND B.PCS_STS_TC = '2'

  

AND B.PT_BSE_DT = '20250930'

  

AND (B.JRN_STS_TC != 'P' OR B.JRN_STS_TC IS NULL) -- 전표미생성 또는 취소 건만 조회

AND B.DEL_YN = 'N'

INNER JOIN TSOL_CR_PT_EVT_SFS C

ON C.IST_CD = B.IST_CD

AND C.PT_TRNO = B.PT_TRNO

AND C.EVL_AREA_ID = B.EVL_AREA_ID

  

AND C.DEL_YN = 'N'

INNER JOIN TSOL_CR_EVL_AREA_CTL D

ON D.IST_CD = A.IST_CD

AND D.EVL_AREA_ID = A.EVL_AREA_ID

AND D.DEL_YN = 'N'

INNER JOIN TSOL_CR_TR_PCS_TP_CTL E

ON E.IST_CD = B.IST_CD

AND E.TR_PCS_TP_ID = B.TR_PCS_TP_ID

AND E.DEL_YN = 'N'

INNER JOIN TSOL_CR_PT_PCS_TP_CTL F

ON F.IST_CD = C.IST_CD

AND F.PT_PCS_TP_ID = C.PT_PCS_TP_ID

AND F.DEL_YN = 'N'

INNER JOIN TSOL_CR_POF_CTL G

ON G.IST_CD = A.IST_CD

AND G.AC_MNG_GRP_ID = A.AC_MNG_GRP_ID

AND G.POF_ID = A.POF_ID

AND G.DEL_YN = 'N'

INNER JOIN TSOL_CR_AC_PCS_IDFR_CTL H

ON H.IST_CD = A.IST_CD

AND H.AC_PCS_IDFR_ID = A.AC_PCS_IDFR_ID

AND H.DEL_YN = 'N'

INNER JOIN TSOL_CR_PRD_EVL_GRP_MPN_SFS I

ON I.IST_CD = A.IST_CD

AND I.AC_MNG_GRP_ID in ('ALL', A.AC_MNG_GRP_ID)

AND I.PRD_TP_ID = A.PRD_TP_ID

  

AND I.DEL_YN = 'N'

INNER JOIN TSOL_CR_AC_EVL_TP_CTL J

ON J.IST_CD = A.IST_CD

AND J.AC_EVL_TP_ID = A.AC_EVL_TP_ID

AND J.DEL_YN = 'N'

LEFT OUTER JOIN TSOL_CR_PT_TLZ_GRP_CTL K

ON K.IST_CD = A.IST_CD

AND K.AC_MNG_GRP_ID = A.AC_MNG_GRP_ID

AND K.PT_TLZ_GRP_ID = A.PT_TLZ_GRP_ID

AND K.DEL_YN = 'N'

)

SELECT T.*

, A.ASJ_NM

, B.ATS_SYM_CD_NM

, B.CSH_CRN_YN

, B.UST_ATS_YN

, B.DR_CDS_TC AS ORG_DR_CDS_TC

FROM (

SELECT A.*

, C.SLP_RUL_ID

, D.SLP_RUL_NM

, D.DR_CDS_TC

, D.ATS_SYM_CD

, E.ASJ_CD

, '' AS SLP_NO

, 0 AS SNO

, '' AS BSE_DT

, '' AS PRJ_ID

, '' AS MGMT_DPM_CD

, '' AS SD_DPM_CD

, A.PCA AS AC_PCA

, A.VCA AS AC_VCA

, '' AS DCD_STS_TC

, '' AS FWD_STS_TC

, 0 AS BSE_XCR

, '' AS AC_SLP_NO

FROM PT A

INNER JOIN TSOL_CR_PT_PCS_TP_SLP_GNT_MPN_SFS B

ON B.IST_CD = A.IST_CD

AND B.EVL_AREA_ID in ('ALL', A.EVL_AREA_ID)

AND B.PT_PCS_TP_ID = A.PT_PCS_TP_ID

AND B.ASJ_TBL_CD = A.ASJ_TBL_CD

AND B.SLP_GNT_YN = 'Y'

AND B.DEL_YN = 'N'

LEFT OUTER JOIN TSOL_CR_SLP_RUL_PT_PCS_TP_MPN_SFS C

ON C.IST_CD = A.IST_CD

AND C.ASJ_TBL_CD = A.ASJ_TBL_CD

AND C.PT_PCS_TP_ID = A.PT_PCS_TP_ID

AND C.EVL_AREA_ID in ('ALL', A.EVL_AREA_ID)

AND C.DEL_YN = 'N'

LEFT OUTER JOIN TSOL_CR_SLP_RUL_CTL D

ON D.IST_CD = C.IST_CD

AND D.SLP_RUL_ID = C.SLP_RUL_ID

AND D.DEL_YN = 'N'

LEFT OUTER JOIN TSOL_CR_ATS_SYM_ASJ_MPN_SFS E

ON E.IST_CD = A.IST_CD

AND E.ASJ_TBL_CD = A.ASJ_TBL_CD

AND E.ATS_SYM_CD = D.ATS_SYM_CD

AND E.EVL_AREA_ID = A.EVL_AREA_ID

AND E.AC_PCS_IDFR_ID IN ('ALL', A.AC_PCS_IDFR_ID)

AND E.DEL_YN = 'N'

WHERE A.JRN_STS_TC IS NULL OR A.JRN_STS_TC != 'P'

UNION ALL

SELECT A.IST_CD

, A.PT_MNG_BSE_NO

, A.AC_PCS_IDFR_ID

, A.EVL_AREA_ID

, A.AC_EVL_TP_ID

, A.AC_MNG_GRP_ID

, A.PRD_CLS_ID

, A.PRD_TP_ID

, A.PRD_NO

, A.PT_TLZ_GRP_ID

, A.PT_TLZ_ID

, A.POF_ID

, A.PT_TRNO

, A.PRD_GRP_TC

, A.TR_PCS_TP_ID

, A.PT_BSE_DT

, A.STM_DT

, A.LNK_DPD_PT_TRNO

, A.PCS_STS_TC

, A.JRN_STS_TC

, B.JRN_BSE_DT

, A.TR_BSC_TRNO

, A.LNK_TR_PT_TRNO

, A.EVT_SNO

, A.PT_PCS_TP_ID

, A.PT_CUR_CD

, A.PCA

, A.EVL_CUR_CD

, A.VCA

, B.THCO_DRW_BNK_CD

, B.THCO_DRW_ANO

, B.CPTY_ROM_BNK_CD

, B.CPTY_ROM_ANO

, B.THCO_ROM_BNK_CD

, B.THCO_ROM_ANO

, B.CPTY_NO

, B.BRN

, A.EVL_AREA_NM

, A.TR_PCS_TP_NM

, A.PT_PCS_TP_NM

, A.POF_NM

, A.AC_PCS_IDFR_NM

, A.EVL_GRP_ID

, A.AC_EVL_TP_NM

, A.PT_TLZ_GRP_NM

, A.BKG_CTT_YN

, A.ASJ_TBL_CD

, B.SLP_RUL_ID

, C.SLP_RUL_NM

, B.DR_CDS_TC

, B.ATS_SYM_CD

, B.ASJ_CD

, B.SLP_NO

, B.SNO

, B.BSE_DT

, B.PRJ_ID

, B.MGMT_DPM_CD

, B.SD_DPM_CD

, B.AC_PCA

, B.AC_VCA

, B.DCD_STS_TC

, B.FWD_STS_TC

, B.BSE_XCR

, B.AC_SLP_NO

FROM PT A

INNER JOIN TSOL_CR_AC_PCS_SFS B

ON A.JRN_STS_TC = 'P'

AND B.IST_CD = A.IST_CD

AND B.BSE_DT = A.PT_BSE_DT

AND B.PT_TRNO = A.PT_TRNO

AND B.JRN_STS_TC = A.JRN_STS_TC

AND B.DEL_YN = 'N'

INNER JOIN TSOL_CR_SLP_RUL_CTL C

ON C.IST_CD = B.IST_CD

AND C.SLP_RUL_ID = B.SLP_RUL_ID

AND C.DEL_YN = 'N'

) T

LEFT OUTER JOIN TSOL_CR_ASJ_CTL A

ON A.IST_CD = T.IST_CD

AND A.ASJ_TBL_CD = T.ASJ_TBL_CD

AND A.ASJ_CD = T.ASJ_CD

AND A.DEL_YN = 'N'

LEFT OUTER JOIN TSOL_CR_ATS_SYM_CTL B

ON B.IST_CD = T.IST_CD

AND B.ASJ_TBL_CD = T.ASJ_TBL_CD

AND B.ATS_SYM_CD = T.ATS_SYM_CD

AND B.DEL_YN = 'N'

ORDER BY T.PT_MNG_BSE_NO, T.PT_BSE_DT, T.PT_TRNO, T.EVT_SNO, T.LNK_DPD_PT_TRNO DESC
```

4.839s 실행 쿼리 최적화 필요

포지션 기준 일자
포지션 거래 번호
상품번호

* 전표상태구분코드 R NULL 전표 미생성 유형
	fwd_sts_tc = 1
	전표규칙 id s2010
	전표규칙이름 SE : 미수수익/ 수입이자
	 현금관련여부 
		 